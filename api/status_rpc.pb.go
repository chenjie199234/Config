// Code generated by protoc-gen-go-rpc. DO NOT EDIT.

package api

import (
	context "context"
	rpc "github.com/chenjie199234/Corelib/rpc"
	error1 "github.com/chenjie199234/Corelib/util/error"
	metadata "github.com/chenjie199234/Corelib/util/metadata"
	proto "github.com/golang/protobuf/proto"
	time "time"
)

var RpcPathStatusPing = "/config.Status/Ping"

// StatusRpcClient is the client API for Status service.
type StatusRpcClient interface {
	//ping check server's health
	Ping(context.Context, *Pingreq) (*Pingresp, error)
}

type statusRpcClient struct {
	cc *rpc.RpcClient
}

//has race,will only return the first's call's client,the config will use the first call's config
func NewStatusRpcClient(timeout, conntimeout, hearttimeout, heartprobe time.Duration, selfgroup, selfname string, verifydata string, picker rpc.PickHandler, discover rpc.DiscoveryHandler) (StatusRpcClient, error) {
	c := &rpc.Config{
		Timeout:                time.Duration(timeout),
		ConnTimeout:            time.Duration(conntimeout),
		HeartTimeout:           time.Duration(hearttimeout),
		HeartPorbe:             time.Duration(heartprobe),
		GroupNum:               1,
		SocketRBuf:             1024,
		SocketWBuf:             1024,
		MaxMsgLen:              65535,
		MaxBufferedWriteMsgNum: 1024,
	}
	cc, e := rpc.NewRpcClient(c, selfgroup, selfname, verifydata, Group, Name, picker, discover)
	if e != nil {
		return nil, e
	}
	return &statusRpcClient{cc: cc}, nil
}

func (c *statusRpcClient) Ping(ctx context.Context, req *Pingreq) (*Pingresp, error) {
	if req == nil {
		return nil, rpc.ERRREQUEST
	}
	reqd, _ := proto.Marshal(req)
	callback, e := c.cc.Call(ctx, 200000000, RpcPathStatusPing, reqd, metadata.GetAllMetadata(ctx))
	if e.(*error1.Error) != nil {
		return nil, e
	}
	resp := new(Pingresp)
	if e := proto.Unmarshal(callback, resp); e != nil {
		return nil, rpc.ERRRESPONSE
	}
	return resp, nil
}

// StatusRpcServer is the server API for Status service.
type StatusRpcServer interface {
	//ping check server's health
	Ping(context.Context, *Pingreq) (*Pingresp, error)
}

func _Status_Ping_RpcHandler(handler func(context.Context, *Pingreq) (*Pingresp, error)) rpc.OutsideHandler {
	return func(ctx *rpc.Context) {
		req := new(Pingreq)
		if e := proto.Unmarshal(ctx.GetBody(), req); e != nil {
			ctx.Abort(rpc.ERRREQUEST)
			return
		}
		resp, e := handler(ctx, req)
		if e != nil {
			ctx.Abort(e)
			return
		}
		if resp == nil {
			resp = new(Pingresp)
		}
		respd, _ := proto.Marshal(resp)
		ctx.Write(respd)
	}
}
func RegisterStatusRpcServer(engine *rpc.RpcServer, svc StatusRpcServer, allmids map[string]rpc.OutsideHandler) error {
	//avoid lint
	_ = allmids
	if e := engine.RegisterHandler(RpcPathStatusPing, 200000000, _Status_Ping_RpcHandler(svc.Ping)); e != nil {
		return e
	}
	return nil
}
